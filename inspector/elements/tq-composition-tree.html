<!-- Copyright 2016 The Fuchsia Authors. All rights reserved. -->

<dom-module id="tq-composition-tree">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      .composition-tree-node-embodiments:before {
        content: " \2014  ";
      }

      .composition-tree-node-embodiments {
        font-style: italic;
      }
    </style>

    <paper-material elevation="1">
      <h1>Composition Tree</h1>
      <div id="tree">
      </div>
    </paper-material>
  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'tq-composition-tree',
        properties: {
          json: {
            type: Object,
            observer: '_jsonChanged',
          },
        },
        _jsonChanged: function() {
          Polymer.dom(this.$.tree).innerHTML = '';
          this._addNode(this.json.tree, this.$.tree);
        },
        _renderNode: function(node) {
          let div = document.createElement('div');
          Polymer.dom(div).setAttribute('class', 'composition-tree-node');

          let url = document.createElement('span');
          Polymer.dom(url).setAttribute('class', 'composition-tree-node-url');
          Polymer.dom(url).appendChild(document.createTextNode(node.url));
          Polymer.dom(div).appendChild(url);

          let embodiments = document.createElement('span');
          Polymer.dom(embodiments).setAttribute('class', 'composition-tree-node-embodiments');
          Polymer.dom(embodiments).appendChild(document.createTextNode(node.embodiments.join(', ')));
          Polymer.dom(div).appendChild(embodiments);

          return div;
        },
        _addNode: function(node, parent) {
          console.log('renderNode', node, parent);
          let div = this._renderNode(node);
          Polymer.dom(parent).appendChild(div);
          if (node.children && node.children.length) {
            let ul = document.createElement('ul');
            Polymer.dom(div).appendChild(ul);
            for (let i=0; i<node.children.length; i++) {
              let li = document.createElement('li');
              Polymer.dom(ul).appendChild(li);
              this._addNode(node.children[i], li);
            }
          }
        }
      });

      inspectorElements['compositionTree'] = 'tq-composition-tree';
    })();
  </script>
</dom-module>
